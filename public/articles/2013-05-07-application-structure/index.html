<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>
    Application Structure // cat /dev/random
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="Application Structure in Flask">
<meta name="keywords" content="">
<meta name="author" content="">


  <meta property="og:title" content="Application Structure" />
<meta property="og:description" content="Application Structure in Flask" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://localhost:1313/articles/2013-05-07-application-structure/" />


  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="http://localhost:1313/css/normalize.css">
  <link rel="stylesheet" href="http://localhost:1313/css/skeleton.css">
  <link rel="stylesheet" href="http://localhost:1313/css/main.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="cat /dev/random" />

  
  <link rel="stylesheet" href="http://localhost:1313/css/highlight/github.css">
  <script src="http://localhost:1313/js/highlight.min.js"></script>

  <script>hljs.initHighlightingOnLoad();</script>

  
</head>


<body>
      <div class="post-header">
  <div class="container">
    <div class="row">
      <div class="eight columns">
        <h4><a href="/">CAT /DEV/RANDOM</a></h4>
      </div>
      <div class="four columns">
        <ul class="nav-list">
          <li><a href="/about">About</a></li>
          <li><a href="/articles">Blog</a></li>
          <li><a href="/projects">Projects</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


  <div class="container">
    <div class="row">

      <section>
            <h1 class="post-title">
              <a href="/articles/2013-05-07-application-structure/">Application Structure</a>
            </h1>

          <div class="post-content-meta">

            
              <span class="post-tag"> Published on  </span>
              <span class="post-date">
                <span class="post-date-month">January</span> 
                <span class="post-date-day"> 1, </span>
                <span class="post-date-year">0001</span>
              </span> 
            

            
              <span class="post-tag"> in </span>
            
                
                  <a class="post-tag post-tag-python" href="http://localhost:1313/tags/python">#python</a>
                
                  <a class="post-tag post-tag-flask" href="http://localhost:1313/tags/flask">#flask</a>
                
            

         </div>

			

			

      <div class="post-content">
        

<p>In this post, we&rsquo;re going to talk about a seemingly easy but an important topic - organizing and structuring your flask applications.</p>

<p>As mentioned earlier, getting started with flask is super easy. Unlike django, flask doesn&rsquo;t follow a directory structure when you start a new app. Flask will not complain even if all of your code resides in a single <code>main.py</code> file. But we all know that that is not the way to go. Having all your code in one file makes it messy and unmaintainable.</p>

<p>Lets assume that you&rsquo;ve gone through the throughly explained <a href="http://flask.pocoo.org/docs/tutorial/">flaskr tutorial</a> (which you definitely should in case you haven&rsquo;t) and unable to contain the excitement you start a new flask app. As you keep writing more code and see it working you start getting that nice feeling about the awesomeness of flask. However, as your code keeps growing and since its all in a single file you start getting frustrated. Configurations, models, views etc. should definitely go in separate files, you think, so that your application is kept modular. But where do you start?</p>

<p>This post will provide you an answer and show you a good way of structuring your apps. For starters, the flask <a href="http://flask.pocoo.org/docs/patterns/packages/">patterns site</a> provides an easy-to-follow tutorial for structuring an app. This post will cover that and will go beyond by covering configuration module and an extension called <a href="http://flask-script.readthedocs.org/en/latest/">flask-script</a>. Lets get started!</p>

<h3 id="packages:525b40148a9479e24bac6a1071f90cd4">Packages</h3>

<p>For larger applications going the packages way is generally a good idea.  A small app might look like this -</p>

<p>{% highlight python %}
- myapp
  |- static
  |- templates
  |- main.py
{% endhighlight %}</p>

<p>To change this into a python module all you need to do is move the files in a separate folder and create a new file ( or rename the existing <code>main.py</code> ) <code>__init__.py</code> so that python can interpret the folder as a module. After re-structuring your app will look like this -</p>

<p>{% highlight python %}
- myapp
  |- hello
    |&ndash; <strong>init</strong>.py
    |&ndash; static
    |&ndash; templates
    |&ndash; main.py
{% endhighlight %}</p>

<p>The next step is to separate app initialization, models and views declaration from your <code>__init__.py</code>. To do that write the following code in your <code>__init__.py</code>. Note: I&rsquo;m assuming that you&rsquo;re assuming sqlalchemy as your ORM. Additionally, I&rsquo;ve used hello as the name of the app folder.</p>

<p>{% highlight python %}</p>

<h1 id="flask-imports-go-here:525b40148a9479e24bac6a1071f90cd4">flask imports go here</h1>

<p>from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy
import os</p>

<h1 id="declaring-the-app:525b40148a9479e24bac6a1071f90cd4">declaring the app</h1>

<p>app = Flask(<strong>name</strong>)</p>

<h1 id="get-the-base-dir:525b40148a9479e24bac6a1071f90cd4">get the base dir</h1>

<p>base_dir = os.path.dirname(os.path.abspath(<strong>file</strong>))
app.config.from_pyfile(os.path.join(base_dir, &lsquo;../app.cfg&rsquo;))</p>

<h1 id="create-db:525b40148a9479e24bac6a1071f90cd4">create db</h1>

<p>db = SQLAlchemy(app)</p>

<h1 id="importing-views:525b40148a9479e24bac6a1071f90cd4">importing views</h1>

<p>import hello.views</p>

<h1 id="import-models:525b40148a9479e24bac6a1071f90cd4">import models</h1>

<p>from hello.models.person import Person
{% endhighlight %}</p>

<p>In this code, you&rsquo;ll notice that <code>hello.views</code>, <code>hello.models.person</code> and <code>app.cfg</code> are missing files. Don&rsquo;t worry, we&rsquo;ll create them soon. The rest of the code is self-explainatory. We get the base directory so that we can easily reference the config file to instantiate our app.</p>

<h3 id="application-configuration:525b40148a9479e24bac6a1071f90cd4">Application Configuration</h3>

<p>The next step is to create the missing files. In your app (in my case -
hello) folder, create a new folder called <code>models</code> and add your models
(either separately or all in single file).  Dont forget to create a
blank <code>__init__.py</code> file in this folder as well. Next, create a file
called <code>app.cfg</code> to store your configuration. This file should reside
alongside your app (or hello) folder. Finally, inside your app (or
hello) folder add all your views in a file <code>views.py</code>. Below is a sample
excerpt of how your files should look like.</p>

<p>{% highlight python %}</p>

<h1 id="sample-app-cfg:525b40148a9479e24bac6a1071f90cd4">sample app.cfg</h1>

<p>DEBUG = True
SECRET= &ldquo;mysupersecretkey&rdquo;</p>

<h1 id="dummy-model-inside-models-folder:525b40148a9479e24bac6a1071f90cd4">dummy model inside models folder</h1>

<h1 id="filename-hello-models-dummy-py:525b40148a9479e24bac6a1071f90cd4">filename hello/models/dummy.py</h1>

<p>from hello import db
class Dummy(db.Model):
  pass</p>

<h1 id="views-inside-hello-views-py:525b40148a9479e24bac6a1071f90cd4">views inside hello/views.py</h1>

<p>from hello import app
from hello.models.dummy import Dummy
from flask import render_template
@app.route(&lsquo;/&rsquo;)
def hello():
  return render_template(&lsquo;index.html&rsquo;)
{% endhighlight %}</p>

<p>At this stage this is how your structure looks like -</p>

<p>{% highlight python %}
- myapp
  |- app.cfg
  |- hello
    |&ndash; <strong>init</strong>.py
    |&ndash; static/
    |&ndash; templates/
    |&ndash; views.py
    |&ndash; models/
      |&mdash; <strong>init</strong>.py
      |&mdash; dummy.py
{% endhighlight %}</p>

<p>If you&rsquo;ve noticed we still haven&rsquo;t told our app to run. To do that, create
a new file called <code>manage.py</code> alongside <code>app.cfg</code> and enter the
following code -</p>

<p>{% highlight python %}
from hello import app
from hello import db</p>

<p>if <strong>name</strong> == &ldquo;<strong>main</strong>&ldquo;:
  app.run()
{% endhighlight %}</p>

<p>Now that you have everything setup, your app should work. Give it a go by running <code>python manage.py</code>
and make sure there aren&rsquo;t any import errors.</p>

<h3 id="flask-script:525b40148a9479e24bac6a1071f90cd4">Flask Script</h3>

<p>One last thing I need to introduce before we wrap up is a flask extension called
<a href="http://flask-script.readthedocs.org/en/latest/">flask-script</a>. The
flask-script extensions provides support for writing scripts and makes
it super easy to add commands that can runserver, open shell, manage
cronjobs and other things right from the terminal. The documentation for
the extension is very easy to follow and I encourage you to give it a
read. I&rsquo;ve edited the <code>manage.py</code> file and added support for
flask-script.</p>

<p>{% highlight python %}
from flask.ext.script import Manager, Server, Shell
from hello import app
from hello import db</p>

<h1 id="optional-include-models-if-you-want-to:525b40148a9479e24bac6a1071f90cd4">(optional) - include models if you want to!</h1>

<p>import hello.models as models</p>

<p>def _make_context():
  &ldquo;&rdquo;&rdquo; context for passing into to the shell command &ldquo;&rdquo;&rdquo;
  return dict(app=app, db=db, models=models)</p>

<h1 id="set-manager:525b40148a9479e24bac6a1071f90cd4">set manager</h1>

<p>manager = Manager(app)</p>

<h1 id="add-commands:525b40148a9479e24bac6a1071f90cd4">add commands</h1>

<p>manager.add_command(&ldquo;runserver&rdquo;, Server())
manager.add_command(&ldquo;shell&rdquo;, Shell(make_context = _make_context))</p>

<p>if <strong>name</strong> == &ldquo;<strong>main</strong>&ldquo;:
  manager.run()
{% endhighlight %}</p>

<p>After making these changes, simply run <code>python manage.py runserver</code> to
run the app and <code>python manage.py shell</code> to jump into a python shell
with your application context, db and models loaded!</p>

<p>I hope this has been a fun tutorial for you to follow. If there are any
issues feel free to email me.</p>

<p>The code for this lesson is available on my <a href="https://github.com/prakhar1989/flask-tuts/tree/master/lesson-1/hello">github</a>.</p>

<p>In the next post we&rsquo;re going to delve further into the topic of project structure by taking a look at <strong>blueprints in Flask</strong>.</p>

<p>See you next time!</p>

      </div>
	
			

      </div>

      <div class="row paging">
			
          
          <div class="six columns">
            <span>&larr;</span>
            <a class="paging-link" href="/articles/2013-05-06-beginning-flask/">Beginning Flask</a>
          </div>
          

					
          <div class="paging-newer six columns">
            <a class="paging-link" href="/articles/2013-05-08-using-blueprints/">Using Blueprints</a>
            <span>&rarr;</span>
          </div>
          

      
       </div>


          
          	
          
    </div>
  </div>
	

	

    </div>
      <div class="footer">
	<hr class="thin" />
  <p>Designed with ♥ by Prakhar Srivastav. Powered by <a href="http://gohugo.io">Hugo</a>.</p>
</div>

  </div>
<script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
